This could totally use a literate program doc.

It needs considerable describing.